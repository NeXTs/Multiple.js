!function(t,e){"undefined"!=typeof module?module.exports=e():"function"==typeof define&&"object"==typeof define.amd?define(e):t.Multiple=e()}(this,function(){"use strict";var t="ontouchstart"in window||navigator.maxTouchPoints,e="WebkitAppearance"in document.documentElement.style;e&&window.addEventListener("resize",function(t){document.body.style.visibility="hidden",t=document.body.offsetHeight,document.body.style.visibility=""});var i=function(e){return this instanceof i?(["selector","background","affectText","opacity"].forEach(function(t){this[t]=e[t]}.bind(this)),this.className="multiple-"+(t?"mobile":"desktop")+(this.affectText?"-text":""),void this.update(this.background)):new i(e)};return i.prototype={constructor:i,each:function(t,e,i){Array.prototype.slice.call(i?t:document.querySelectorAll(t)).forEach(e.bind(this))},setOpacity:function(t){return t.replace(/#\b([a-f\d]{3}|[a-f\d]{6})\b/gi,function(t,e){var i=e.match(new RegExp("(.{"+e.length/3+"})","g")).map(function(t){return parseInt(e.length%2?t+t:t,16)});return"rgb("+i.join(",")+")"}).replace(/rgb\((.[^\)]*)\)/gi,function(t,e){var i,n=(255-(i=Math.min.apply(Math,e=e.split(","))))/255,s=this.opacity===!0?e.map(function(t){return 0|(t-i)/n}).concat((0|1e3*n)/1e3):e.concat(this.opacity);return"rgba("+s.join(",")+")"}.bind(this))},setVendors:function(t,e){var i=e?[]:[t];return(/-gradient\(/i.test(t)||e)&&["webkit","moz","ms","o"].forEach(function(n,s){e&&s||i.unshift((e?"-webkit-linear-gradient(transparent,transparent),":"")+t.replace(/([^,\s]*-gradient\()/gi,"-"+n+"-$1"))}),i},setStyles:function(t,e,i){this.opacity&&(e=this.setOpacity(e)),this.styleTag.innerHTML=t+"{background-image:"+this.setVendors(e,i).join(";\nbackground-image:")+"}"},renderTag:function(t){var e=document.createElement("div");return e.className=t,e},update:function(e){this.each(this.selector,function(e){if(!e.getAttribute("data-multiple")){if(!t||this.affectText)return e.classList.add(this.className);var i=this.renderTag(this.className+"-wrapper"),n=this.renderTag(this.className+"-content");this.each(e.childNodes,function(t){n.appendChild(t)},!0),e.appendChild(i),i.appendChild(this.renderTag(this.className)),i.appendChild(n),e.setAttribute("data-multiple",!0)}}),e&&(this.styleTag||document.head.appendChild(this.styleTag=document.createElement("style")),t&&this.affectText||this.setStyles(this.selector+(t?" ":"")+"."+this.className+(t?":before":""),e,this.affectText),this.affectText&&(this.styleTag.innerHTML+=this.selector+"."+this.className+"{color:"+this.affectText+"}"))},destroy:function(){this.styleTag.parentNode&&this.styleTag.parentNode.removeChild(this.styleTag)&&delete this.styleTag,this.each(this.selector,function(e){e.classList.remove(this.className),e.removeAttribute("data-multiple"),t&&!this.affectText&&(this.each(e.children[0].children[1].childNodes,function(t){e.appendChild(t)},!0),e.removeChild(e.children[0]))})}},i});